#!/usr/bin/env plash-exec

--from fedora

--run
tmp=$(mktemp -d)
cd $tmp

--dnf git make automake autoconf gcc glibc-static meson ninja-build

--run
git clone https://github.com/libfuse/libfuse && \
    cd libfuse && \
    mkdir build && \
    cd build && \
    LDFLAGS="-lpthread" meson --prefix /usr -D default_library=static .. && \
    ninja && \
    ninja install

git clone https://github.com/containers/fuse-overlayfs && \
    cd fuse-overlayfs && \
    sh autogen.sh && \
    LIBS="-ldl" LDFLAGS="-static" ./configure --prefix /usr && \
    make && \
    make install

--layer

--entrypoint-script
exec cp /usr/bin/fuse-overlayfs build/fuse-overlayfs
